<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Intelligence Dashboard | Elevare Insights</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #F8FAFB; color: #1A3A52; line-height: 1.6; }
    
    /* Header */
    .dashboard-header { background: linear-gradient(135deg, #1A3A52 0%, #2A5570 100%); padding: 16px 40px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); display: flex; justify-content: space-between; align-items: center; }
    .logo-container img { height: 50px; width: auto; }
    .client-badge { text-align: right; }
    .client-badge-label { font-size: 11px; color: rgba(255,255,255,0.7); font-weight: 500; letter-spacing: 0.5px; }
    .client-badge-name { font-size: 18px; color: #FFFFFF; font-weight: 700; margin-top: 2px; }
    
    /* Navigation */
    .nav-tabs { background: #FFFFFF; border-bottom: 2px solid #E8EDF2; padding: 0 40px; display: flex; gap: 0; overflow-x: auto; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
    .nav-tab { padding: 16px 24px; font-size: 14px; font-weight: 500; color: #6B7280; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; }
    .nav-tab:hover { color: #00D9C8; background: rgba(0, 217, 200, 0.05); }
    .nav-tab.active { color: #00D9C8; border-bottom-color: #00D9C8; background: #FFFFFF; font-weight: 600; }
    
    /* Layout */
    .dashboard-container { display: flex; min-height: calc(100vh - 120px); }
    .sidebar { width: 300px; background: #FFFFFF; border-right: 1px solid #E8EDF2; padding: 30px 24px; overflow-y: auto; box-shadow: 2px 0 8px rgba(0, 0, 0, 0.03); }
    .main-content { flex: 1; padding: 30px 40px; overflow-y: auto; background: #F8FAFB; }
    
    /* Filters */
    .filter-section { margin-bottom: 28px; }
    .filter-title { font-size: 11px; font-weight: 700; color: #1A3A52; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #00D9C8; }
    .filter-group { margin-bottom: 20px; }
    .filter-label { font-size: 13px; color: #1A3A52; margin-bottom: 8px; display: block; font-weight: 600; }
    .filter-select { width: 100%; padding: 10px 12px; background: #F8FAFB; border: 1px solid #D1D9E0; border-radius: 6px; color: #1A3A52; font-size: 14px; transition: all 0.2s; cursor: pointer; }
    .filter-select:focus { outline: none; border-color: #00D9C8; box-shadow: 0 0 0 3px rgba(0, 217, 200, 0.1); background: #FFFFFF; }
    .filter-input { width: 100%; padding: 10px 12px; background: #F8FAFB; border: 1px solid #D1D9E0; border-radius: 6px; color: #1A3A52; font-size: 14px; transition: all 0.2s; }
    .filter-input:focus { outline: none; border-color: #00D9C8; box-shadow: 0 0 0 3px rgba(0, 217, 200, 0.1); background: #FFFFFF; }
    
    /* Checkbox */
    .checkbox-group { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: #F8FAFB; border: 1px solid #D1D9E0; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .checkbox-group:hover { border-color: #00D9C8; background: rgba(0, 217, 200, 0.05); }
    .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #00D9C8; }
    .checkbox-group label { font-size: 13px; color: #1A3A52; font-weight: 500; cursor: pointer; flex: 1; }
    
    .record-counter { font-size: 12px; color: #6B7280; margin-top: 6px; font-weight: 500; }
    .record-counter strong { color: #00D9C8; }
    .filter-button { width: 100%; padding: 12px; background: linear-gradient(135deg, #00D9C8 0%, #00B8A8 100%); color: #FFFFFF; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0, 217, 200, 0.2); }
    .filter-button:hover { background: linear-gradient(135deg, #00B8A8 0%, #008B8B 100%); transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0, 217, 200, 0.3); }
    .filter-reset { width: 100%; padding: 10px; background: transparent; color: #6B7280; border: 1px solid #D1D9E0; border-radius: 6px; font-size: 13px; cursor: pointer; margin-top: 10px; transition: all 0.2s; }
    .filter-reset:hover { border-color: #1A3A52; color: #1A3A52; }
    
    /* Content */
    .content-header { margin-bottom: 30px; }
    .content-title { font-size: 32px; font-weight: 700; color: #1A3A52; margin-bottom: 10px; }
    .content-description { font-size: 15px; color: #6B7280; line-height: 1.7; }
    
/* Chart Container */
.chart-container { 
  background: #FFFFFF; 
  border: 1px solid #E8EDF2; 
  border-radius: 10px; 
  padding: 15px 28px 28px 28px; 
  margin-bottom: 24px; 
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); 
  max-width: 1300px;
}

.chart-header { 
  margin-bottom: 14px; 
  padding-bottom: 10px; 
  border-bottom: 2px solid #F8FAFB; 
}

.chart-title { 
  font-size: 20px; 
  font-weight: 600; 
  color: #1A3A52; 
}

/* Map */
.map-container { 
  position: relative; 
  width: 100%; 
  min-height: 450px; 
  margin-top: 8px; 
  overflow: hidden; 
}

#datawrapper-vis-JStJR { 
  position: relative; 
  margin-left: -600px !important; 
  width: calc(100% + 600px) !important; 
  margin-bottom: -90px !important;
  overflow: hidden !important;
  max-height: 440px !important;
}    
    .overlay-data { 
      position: absolute; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      pointer-events: none; 
      z-index: 100; 
    }
    
    .county-data { 
      position: absolute; 
      background: rgba(255, 255, 255, 0.98); 
      border: 1px solid #E8EDF2; 
      border-left: 4px solid #00D9C8; 
      border-radius: 8px; 
      padding: 16px; 
      pointer-events: auto; 
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12); 
      font-size: 12px; 
      min-width: 200px; 
z-index: 101;
    }
    
    .stat-header { 
      font-size: 15px; 
      font-weight: 700; 
      color: #1A3A52; 
      margin-bottom: 12px; 
      padding-bottom: 10px; 
      border-bottom: 2px solid #00D9C8; 
    }
    
    .stat-row { 
      display: flex; 
      justify-content: space-between; 
      padding: 4px 0; 
      line-height: 1.5; 
    }
    
    .stat-row.indent { 
      padding-left: 16px; 
      opacity: 0.85; 
    }
    
    .stat-row .label { 
      color: #6B7280; 
      font-size: 11px; 
      font-weight: 500; 
    }
    
    .stat-row .value { 
      font-weight: 700; 
      color: #1A3A52; 
      font-size: 11px; 
    }
    
    .stat-divider { 
      height: 1px; 
      background: #E8EDF2; 
      margin: 10px 0; 
    }
    
    .essex { 
      top: 60%; 
      right: 30%; 
    }
    
    .surrey { 
      top: 46%; 
      left: 3%; 
    }
    
    .london { 
      top: 4%; 
      left: 22%; 
    }
    
    /* Stats Cards - BELOW MAP */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 30px; margin-bottom: 30px; }
    .stat-card { background: #FFFFFF; border: 1px solid #E8EDF2; border-radius: 10px; padding: 24px; transition: all 0.2s; border-left: 4px solid #00D9C8; }
    .stat-card:hover { box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08); transform: translateY(-2px); }
    .stat-label { font-size: 13px; color: #6B7280; margin-bottom: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-value { font-size: 36px; font-weight: 700; color: #1A3A52; margin-bottom: 6px; }
    .stat-context { font-size: 13px; color: #9CA3AF; }
    
    /* Tabs */
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Tables */
    .data-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    .data-table thead { background: linear-gradient(135deg, #1A3A52 0%, #2A5570 100%); }
    .data-table th { padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; color: #FFFFFF; text-transform: uppercase; letter-spacing: 0.5px; }
    .data-table td { padding: 14px 16px; font-size: 14px; color: #1A3A52; border-bottom: 1px solid #E8EDF2; }
    .data-table tr:hover { background: rgba(0, 217, 200, 0.05); }
    
    /* Insights */
    .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 24px; }
    .insight-card { background: #FFFFFF; border: 1px solid #E8EDF2; border-radius: 10px; padding: 24px; transition: all 0.2s; border-left: 4px solid #00D9C8; }
    .insight-card:hover { box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08); transform: translateY(-2px); }
    .insight-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
    .insight-icon { font-size: 26px; }
    .insight-title { font-size: 16px; font-weight: 600; color: #1A3A52; }
    .insight-text { font-size: 14px; color: #6B7280; line-height: 1.7; }
    
    /* Reports */
    .report-card { background: #FFFFFF; border: 1px solid #E8EDF2; border-left: 4px solid #00D9C8; border-radius: 10px; padding: 24px; margin-bottom: 20px; transition: all 0.2s; cursor: pointer; }
    .report-card:hover { box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08); transform: translateY(-2px); }
    .report-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 14px; }
    .report-icon { font-size: 36px; margin-right: 16px; }
    .report-title { font-size: 18px; font-weight: 600; color: #1A3A52; margin-bottom: 6px; }
    .report-meta { font-size: 13px; color: #9CA3AF; }
    .report-summary { font-size: 14px; color: #6B7280; line-height: 1.7; margin-bottom: 14px; }
    .report-actions { display: flex; gap: 10px; }
    .btn { padding: 8px 18px; background: #FFFFFF; border: 1px solid #D1D9E0; border-radius: 6px; color: #1A3A52; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .btn:hover { border-color: #00D9C8; color: #00D9C8; background: rgba(0, 217, 200, 0.05); }
    .btn.primary { background: linear-gradient(135deg, #00D9C8 0%, #00B8A8 100%); border: none; color: #FFFFFF; }
    .btn.primary:hover { background: linear-gradient(135deg, #00B8A8 0%, #008B8B 100%); transform: translateY(-1px); }
    
    .loading { text-align: center; padding: 80px 20px; color: #9CA3AF; font-size: 15px; }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .dashboard-container { flex-direction: column; }
      .sidebar { width: 100%; border-right: none; border-bottom: 1px solid #E8EDF2; }
      .overlay-data { position: relative; margin-top: 20px; }
      .county-data { position: relative; margin: 12px 0; width: 100%; top: auto !important; left: auto !important; right: auto !important; }
    }
    @media (max-width: 768px) {
      .dashboard-header { padding: 14px 20px; flex-direction: column; gap: 12px; }
      .client-badge { text-align: center; }
      .nav-tabs { padding: 0 20px; }
      .main-content { padding: 20px; }
      .stats-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- Header with Logo + Client Badge -->
<div class="dashboard-header">
  <div class="logo-container">
    <img src="/images/logo.png" alt="Elevare Insights" style="height: 50px; width: auto;">
  </div>
  <div class="client-badge">
    <div class="client-badge-name">XPENG UK</div>
  </div>
</div>

<!-- Navigation Tabs -->
<div class="nav-tabs">
  <div class="nav-tab" data-tab="summary">Intelligence Summary</div>
  <div class="nav-tab active" data-tab="geographic">Geographic Distribution</div>
  <div class="nav-tab" data-tab="dealer">Dealer Intelligence</div>
  <div class="nav-tab" data-tab="routes">Acquisition Routes</div>
  <div class="nav-tab" data-tab="behavioral">Behavioral Analytics</div>
  <div class="nav-tab" data-tab="competitive">Competitive Intelligence</div>
  <div class="nav-tab" data-tab="product">Product Intelligence</div>
  <div class="nav-tab" data-tab="escalations">OEM Escalations</div>
  <div class="nav-tab" data-tab="reports">Reports</div>
</div>

<!-- Main Container -->
<div class="dashboard-container">
  
  <!-- Sidebar Filters -->
  <div class="sidebar">
    <div class="filter-section">
      <div class="filter-title">Data Filters</div>
      
      <div class="filter-group">
        <label class="filter-label">Counties</label>
        <select class="filter-select" id="filter-counties" multiple size="1">
          <option value="all">All Counties</option>
          <option value="london">London</option>
          <option value="surrey">Surrey</option>
          <option value="essex">Essex</option>
          <option value="kent">Kent</option>
          <option value="berkshire">Berkshire</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Member Status</label>
        <select class="filter-select" id="filter-status" multiple size="1">
          <option value="all">All Members</option>
          <option value="owner">Owner</option>
          <option value="prospect">Prospect</option>
          <option value="prospect-intent">Prospect (Expressed Intent)</option>
          <option value="dealer">Dealer / Partner</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Purchase Route</label>
        <select class="filter-select" id="filter-route">
          <option selected>All Routes</option>
          <option>Route B1</option>
          <option>Route B2</option>
          <option>Route B3</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Model Type</label>
        <select class="filter-select" id="filter-model">
          <option selected>All Models</option>
          <option>Model_1</option>
          <option>Model_2</option>
        </select>
      </div>

      <!-- Data Detail Level Toggle -->
      <div class="filter-group">
        <label class="filter-label">Data Level</label>
        <div class="checkbox-group">
          <input type="checkbox" id="filter-commercial" onchange="toggleCommercialData()">
          <label for="filter-commercial">Show Detailed Intelligence View</label>
        </div>
        <div style="font-size: 11px; color: #6B7280; margin-top: 6px; font-style: italic;">
          Displays specific vehicle models, purchase routes & provider details for owners & verified prospects
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">Record Limit</label>
        <input type="number" class="filter-input" id="filter-limit" value="25" min="1" max="849" placeholder="Enter number">
        <div class="record-counter" id="record-counter">
          Displaying <strong>25</strong> of <strong>794</strong> records
        </div>
      </div>

      <button class="filter-button" onclick="applyFilters()">Apply Filters</button>
      <button class="filter-reset" onclick="resetFilters()">Reset All</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    
    <!-- GEOGRAPHIC DISTRIBUTION TAB -->
    <div class="tab-content active" id="tab-geographic">
      <div class="content-header">
        <h1 class="content-title">Geographic Distribution</h1>
        <p class="content-description">Geographic distribution of owner & verified prospects across UK markets, with purchase route intelligence and acquisition intent mapping.</p>
      </div>

      <!-- Map FIRST, Stats BELOW -->    
        <div class="map-container">
          <div style="min-height:502px" id="datawrapper-vis-JStJR">
            <script type="text/javascript" defer src="https://datawrapper.dwcdn.net/JStJR/embed.js" charset="utf-8" data-target="#datawrapper-vis-JStJR"></script>
            <noscript><img src="https://datawrapper.dwcdn.net/JStJR/full.png" alt="Choropleth map" /></noscript>
          </div>

          <div class="overlay-data">
            <div class="county-data essex">
  <div class="stat-header">ESSEX</div>
  <div class="stat-row">
    <span class="label">Owner (Model_1) Count:</span>
    <span class="value">3</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">2</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B3:</span>
    <span class="value">1</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat-row">
    <span class="label">Prospect (Model_1) Count:</span>
    <span class="value">3</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">2</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B2:</span>
    <span class="value">1</span>
  </div>
</div>
            <div class="county-data surrey">
  <div class="stat-header">SURREY</div>
  <div class="stat-row">
    <span class="label">Owner (Model_1) Count:</span>
    <span class="value">2</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">2</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat-row">
    <span class="label">Prospect (Model_1) Count:</span>
    <span class="value">3</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">2</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B2:</span>
    <span class="value">1</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat-row">
    <span class="label">Prospect (Model_2) Count:</span>
    <span class="value">1</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">1</span>
  </div>
</div>
      <div class="county-data london">
  <div class="stat-header">LONDON</div>
  <div class="stat-row">
    <span class="label">Owner (Model_1) Count:</span>
    <span class="value">5</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">5</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat-row">
    <span class="label">Prospect (Model_1) Count:</span>
    <span class="value">12</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B1:</span>
    <span class="value">8</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B2:</span>
    <span class="value">3</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B3:</span>
    <span class="value">1</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat-row">
    <span class="label">Prospect (Model_2) Count:</span>
    <span class="value">1</span>
  </div>
  <div class="stat-row indent">
    <span class="label">Purchase Route B3:</span>
    <span class="value">1</span>
  </div>
</div>
          </div>
        </div>
      </div>

      <!-- Stats Cards - NOW BELOW MAP -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Southeast Total</div>
          <div class="stat-value">26</div>
          <div class="stat-context">7 Owners ‚Ä¢ 19 Prospects</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">London Concentration</div>
          <div class="stat-value">73%</div>
          <div class="stat-context">19 of 26 members</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Density Score</div>
          <div class="stat-value">High</div>
          <div class="stat-context">Urban clustering</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Route B1 Dominance</div>
          <div class="stat-value">93%</div>
          <div class="stat-context">Primary channel</div>
        </div>
      </div>

      <!-- Insights -->
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-header">
            <span class="insight-icon">üéØ</span>
            <div class="insight-title">London Dominance</div>
          </div>
          <div class="insight-text">
            73% concentration in London (19/26 members) creates immediate dealer expansion opportunity in highest-density market.
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-header">
            <span class="insight-icon">üìç</span>
            <div class="insight-title">Route B1 Concentration</div>
          </div>
          <div class="insight-text">
            Purchase Route B1 accounts for 93% of all acquisitions, indicating highly concentrated channel.
          </div>
        </div>
        <div class="insight-card">
          <div class="insight-header">
            <span class="insight-icon">üîÑ</span>
            <div class="insight-title">Prospect Pipeline</div>
          </div>
          <div class="insight-text">
            2.7:1 prospect-to-owner ratio demonstrates strong conversion opportunity across Southeast.
          </div>
        </div>
      </div>

      <!-- Detailed Table -->
      <div class="chart-container" style="margin-top: 30px;">
        <div class="chart-header">
          <h3 class="chart-title">County Breakdown: Complete Data</h3>
          <div style="display: flex; gap: 10px;">
            <button class="btn">Export CSV</button>
          </div>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>County</th>
              <th>Owners</th>
              <th>Prospects</th>
              <th>Total</th>
              <th>Route B1</th>
              <th>Route B2</th>
              <th>Route B3</th>
              <th>Model_2</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>London</strong></td>
              <td>5</td>
              <td>14</td>
              <td><strong>19</strong></td>
              <td>19</td>
              <td>‚Äî</td>
              <td>‚Äî</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td><strong>Surrey</strong></td>
              <td>1</td>
              <td>4</td>
              <td><strong>5</strong></td>
              <td>4</td>
              <td>1</td>
              <td>‚Äî</td>
              <td>1</td>
            </tr>
            <tr>
              <td><strong>Essex</strong></td>
              <td>2</td>
              <td>0</td>
              <td><strong>2</strong></td>
              <td>1</td>
              <td>‚Äî</td>
              <td>1</td>
              <td>‚Äî</td>
            </tr>
            <tr style="background: #F8FAFB; font-weight: 600;">
              <td>TOTAL</td>
              <td>7</td>
              <td>19</td>
              <td><strong>26</strong></td>
              <td>24</td>
              <td>1</td>
              <td>1</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Other tabs -->
    <div class="tab-content" id="tab-dealer">
      <div class="content-header">
        <h1 class="content-title">Dealer Intelligence</h1>
        <p class="content-description">Dealer coverage analysis and network optimization opportunities.</p>
      </div>
      <div class="loading">üîß Dealer intelligence view available in full platform access</div>
    </div>

    <div class="tab-content" id="tab-routes">
      <div class="content-header">
        <h1 class="content-title">Purchase Routes Analysis</h1>
        <p class="content-description">Acquisition channel breakdown and purchase journey patterns.</p>
      </div>
      <div class="loading">üìä Purchase routes analysis available in full platform access</div>
    </div>

    <div class="tab-content" id="tab-competitive">
      <div class="content-header">
        <h1 class="content-title">Competitive Intelligence</h1>
        <p class="content-description">Cross-shopping patterns and market positioning insights.</p>
      </div>
      <div class="loading">‚öîÔ∏è Competitive intelligence available in full platform access</div>
    </div>

    <div class="tab-content" id="tab-escalations">
      <div class="content-header">
        <h1 class="content-title">Manufacturer Escalations</h1>
        <p class="content-description">Product feedback and intelligence escalated to OEM teams.</p>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Escalations</div>
          <div class="stat-value">3</div>
          <div class="stat-context">Q4 2024</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Navigation Report</div>
          <div class="stat-value">66</div>
          <div class="stat-context">Pages delivered</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">UAT Participants</div>
          <div class="stat-value">34</div>
          <div class="stat-context">Community members</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Response Rate</div>
          <div class="stat-value">100%</div>
          <div class="stat-context">OEM engagement</div>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Recent Escalations</h3>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Topic</th>
              <th>Escalated To</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Dec 2024</td>
              <td>Navigation Intelligence Report (66 pages)</td>
              <td>XPENG China Product Team</td>
              <td style="color: #10B981; font-weight: 600;">Under Review</td>
            </tr>
            <tr>
              <td>Nov 2024</td>
              <td>Salary Sacrifice Revenue Risk (¬£770K)</td>
              <td>XPENG UK Operations</td>
              <td style="color: #EF4444; font-weight: 600;">Materialized</td>
            </tr>
            <tr>
              <td>Oct 2024</td>
              <td>Mobile App Battery Drain</td>
              <td>XPENG International Development</td>
              <td style="color: #F59E0B; font-weight: 600;">In Progress</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="tab-timeline">
      <div class="content-header">
        <h1 class="content-title">Timeline Analytics</h1>
        <p class="content-description">Temporal patterns and growth trends.</p>
      </div>
      <div class="loading">üìà Timeline analytics available in full platform access</div>
    </div>

    <div class="tab-content" id="tab-reports">
      <div class="content-header">
        <h1 class="content-title">Intelligence Reports</h1>
        <p class="content-description">Deep-dive analysis reports and strategic intelligence documentation.</p>
      </div>

      <div class="report-card">
        <div class="report-header">
          <div style="display: flex; align-items: start;">
            <span class="report-icon">üìä</span>
            <div>
              <div class="report-title">Marketing Intelligence Report</div>
              <div class="report-meta">Published: December 10, 2024 ‚Ä¢ 12 pages</div>
            </div>
          </div>
          <div class="report-actions">
            <button class="btn primary">View Report</button>
            <button class="btn">Download PDF</button>
          </div>
        </div>
        <div class="report-summary">
          October-November analysis with marketing addendum. Includes geographic distribution intelligence, November revenue validation (¬£770K prediction confirmed), and purchase route analysis.
        </div>
      </div>

      <div class="report-card">
        <div class="report-header">
          <div style="display: flex; align-items: start;">
            <span class="report-icon">üß≠</span>
            <div>
              <div class="report-title">Navigation Intelligence Report</div>
              <div class="report-meta">Published: December 2024 ‚Ä¢ 66 pages</div>
            </div>
          </div>
          <div class="report-actions">
            <button class="btn primary">View Report</button>
            <button class="btn">Download PDF</button>
          </div>
        </div>
        <div class="report-summary">
          Comprehensive product intelligence delivered to XPENG China International Cabin Product Team. Includes competitive analysis vs Tesla/BYD and UAT coordination for VLA 2.0 enhancement.
        </div>
      </div>

      <div class="report-card">
        <div class="report-header">
          <div style="display: flex; align-items: start;">
            <span class="report-icon">üìç</span>
            <div>
              <div class="report-title">Geographic Distribution Analysis</div>
              <div class="report-meta">Published: October 2024 ‚Ä¢ 8 pages</div>
            </div>
          </div>
          <div class="report-actions">
            <button class="btn primary">View Report</button>
            <button class="btn">Download PDF</button>
          </div>
        </div>
        <div class="report-summary">
          Southeast England deep-dive analyzing 26-member concentration. Identified critical dealer coverage gaps and ¬£731K London opportunity.
        </div>
      </div>

      <div class="report-card">
        <div class="report-header">
          <div style="display: flex; align-items: start;">
            <span class="report-icon">üí∞</span>
            <div>
              <div class="report-title">November Revenue Risk Case Study</div>
              <div class="report-meta">Published: November 2024 ‚Ä¢ 5 pages</div>
            </div>
          </div>
          <div class="report-actions">
            <button class="btn primary">View Report</button>
            <button class="btn">Download PDF</button>
          </div>
        </div>
        <div class="report-summary">
          Documentation of ¬£770K salary sacrifice revenue loss prediction and materialization. Demonstrates 3-week advance warning capability vs 6-week lag in SMMT data.
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  // Tab switching
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      const tabId = 'tab-' + tab.getAttribute('data-tab');
      document.getElementById(tabId).classList.add('active');
    });
  });

  // Record limit counter
  const limitInput = document.getElementById('filter-limit');
  const recordCounter = document.getElementById('record-counter');
  
  limitInput.addEventListener('input', function() {
    const limit = parseInt(this.value) || 25;
    const total = 794;
    const displayed = Math.min(limit, total);
    recordCounter.innerHTML = `Displaying <strong>${displayed}</strong> of <strong>${total}</strong> records`;
  });

  // Apply filters
  function applyFilters() {
    const counties = document.getElementById('filter-counties');
    const status = document.getElementById('filter-status');
    updateMultiSelectDisplay(counties);
    updateMultiSelectDisplay(status);
    alert('Filters applied! Dashboard data would refresh here.');
  }

  // Reset filters
  function resetFilters() {
    document.querySelectorAll('.filter-select, .filter-input').forEach(input => {
      if (input.tagName === 'SELECT') {
        input.selectedIndex = 0;
      } else {
        input.value = '25';
      }
    });
    document.getElementById('filter-commercial').checked = false;
    toggleCommercialData();
    recordCounter.innerHTML = 'Displaying <strong>25</strong> of <strong>794</strong> records';
  }

  // Update multi-select display
  function updateMultiSelectDisplay(selectElement) {
    const selected = Array.from(selectElement.selectedOptions);
    if (selected.length > 1) {
      selectElement.setAttribute('data-display', 'Multiple selections');
    } else if (selected.length === 1) {
      selectElement.setAttribute('data-display', selected[0].text);
    }
  }

  // Toggle commercially sensitive data
  function toggleCommercialData() {
    const checkbox = document.getElementById('filter-commercial');
    const labels = document.querySelectorAll('.stat-row .label, .stat-header');
    
    // Define the mappings from generic codes to detailed names
    const detailedMappings = {
      // Models
      'Model_1': 'XPENG G6',
      'Model_2': 'XPENG G9',
      
      // Purchase Routes - Owners (confirmed)
      'Purchase Route B1': 'Salary Sacrifice',
      'Purchase Route B2': 'Personal Lease',
      'Purchase Route B3': 'Direct Purchase',
      
      // Purchase Routes - Prospects (intent) - ready for future granularity
      'Purchase Route B1a': 'SS Intent: Tusker',
      'Purchase Route B1b': 'SS Intent: Octopus',
      'Purchase Route B1c': 'SS Intent: Loveelectric',
      'Purchase Route B1x': 'Salary Sacrifice (All Providers)'
    };
    
    labels.forEach(label => {
      // Store original generic text on first run
      if (!label.dataset.originalText) {
        label.dataset.originalText = label.textContent;
      }
      
      const originalText = label.dataset.originalText;
      
      if (checkbox.checked) {
        // CHECKED = Show detailed/real data (XPENG G6, Salary Sacrifice, etc.)
        let detailedText = originalText;
        
        // Apply all mappings
        Object.keys(detailedMappings).forEach(code => {
          const realName = detailedMappings[code];
          detailedText = detailedText.replace(new RegExp(code, 'g'), realName);
        });
        
        label.textContent = detailedText;
      } else {
        // UNCHECKED = Show anonymized/generic codes (Model_1, Purchase Route B1)
        label.textContent = originalText;
      }
    });
  }

  // Initialize multi-select styling
  document.querySelectorAll('select[multiple]').forEach(select => {
    select.style.height = 'auto';
  });
</script>

<script>
// Target the map-container parent instead
window.addEventListener('load', function() {
  setTimeout(function() {
    const mapContainer = document.querySelector('.map-container');
    const dwContainer = document.getElementById('datawrapper-vis-JStJR');
    
    if (mapContainer && dwContainer) {
      // Apply to parent container
      mapContainer.style.overflow = 'hidden';
      mapContainer.style.width = '100%';
      mapContainer.style.maxWidth = '1200px';
      
      // Force child positioning
      dwContainer.style.setProperty('position', 'relative', 'important');
      dwContainer.style.setProperty('margin-left', '-950px', 'important');
      dwContainer.style.setProperty('width', 'calc(100% + 950px)', 'important');
      dwContainer.style.setProperty('margin-bottom', '-90px', 'important');
      dwContainer.style.setProperty('max-height', '440px', 'important');
      dwContainer.style.setProperty('overflow', 'hidden', 'important');
      
      console.log('Map container styled!');
    }
  }, 1000);
});
</script>

</body>
</html>
